import{_ as a,W as i,X as e,a2 as g}from"./framework-5d92cd28.js";const t="/assets/image-20221123212117483-f2361bab.png",n="/assets/image-20221123212940418-b2e1b3f8.png",s="/assets/image-20221130105511581-ba4bd990.png",r="/assets/image-20221130105708566-d980c215.png",d="/assets/image-20221130105739123-6a303b4f.png",o="/assets/image-20221130105803554-ea6120d7.png",c="/assets/image-20221130105840647-9453294b.png",m="/assets/image-20221130105905797-4bcf5cd6.png",f="/assets/image-20221130105950833-a4bb3d9b.png",p="/assets/image-20221130110813055-6e9efdb3.png",l="/assets/image-20221130111401222-772a37ce.png",h="/assets/image-20221130111532777-05f47362.png",u="/assets/image-20221130111737965-c62bcb33.png",b="/assets/image-20221130111903836-bc86b7b6.png",_="/assets/image-20221130164407329-0ba50968.png",x="/assets/image-20221130164540878-35ac83a2.png",y="/assets/image-20221130164617023-e3717c8e.png",z="/assets/image-20221130164831342-9b59bcc9.png",v="/assets/image-20221130165319719-497acc0a.png",k="/assets/image-20221130165611399-b866424f.png",B="/assets/image-20221130165726722-4f4f7705.png",R="/assets/image-20221130165827313-3f83200e.png",D="/assets/image-20221130165927668-d533b40e.png",w="/assets/image-20221130165944675-0f313f0d.png",O="/assets/image-20221130170222259-db3586f2.png",A="/assets/image-20221201124120286-68e22be0.png",F="/assets/image-20221201124200596-a12c0bf7.png",E="/assets/image-20221201124239610-40c19a61.png",I="/assets/image-20221201124740917-a00038f4.png",G="/assets/image-20221201124936896-98d0cac4.png",N="/assets/image-20221201124951859-d0e4a203.png",S="/assets/image-20221201125036949-1d267b1b.png",V="/assets/image-20221201125039750-ea9551bf.png",W="/assets/image-20221201125110414-10e5a225.png",X="/assets/image-20221201125209830-d1b268d3.png",j="/assets/image-20221201125232566-b23c03c1.png",q="/assets/image-20221201125257947-2294eebd.png",C="/assets/image-20221201130147774-f39aa8d0.png",H="/assets/image-20221201130218293-e988cf03.png",J="/assets/image-20221201130335322-d52dd1c2.png",K="/assets/image-20221201133044164-52cc3989.png",L="/assets/image-20221201133058919-953d70da.png",M="/assets/image-20221201133203006-412de294.png",P="/assets/image-20221201133614121-60b0805e.png",Q="/assets/image-20221201133721902-ed0f31be.png",T="/assets/image-20221201133745221-1647f098.png",U="/assets/image-20221201133831305-f62616bf.png",Y="/assets/image-20221201133909091-8ba6a2b8.png",Z="/assets/image-20221201134432065-833b36c2.png",$="/assets/image-20221201135102534-a5197838.png",aa="/assets/image-20221201135110826-33a7a8a0.png",ia="/assets/image-20221201135309142-c5a7e4f7.png",ea="/assets/image-20221201135330480-54311d2e.png",ga="/assets/image-20221202171757866-8df463d4.png",ta="/assets/image-20221202171828036-41bb1bda.png",na="/assets/image-20221202172242857-bbdb726f.png",sa="/assets/image-20221202174108729-aca8e265.png",ra="/assets/image-20221202174148056-00244cb6.png",da="/assets/image-20221202174646462-31edd14b.png",oa="/assets/image-20221202174743014-45a9d9a2.png",ca="/assets/image-20221202174813420-c656a714.png",ma="/assets/image-20221202175133404-0b02190a.png",fa="/assets/image-20221202175159635-bf5f3464.png",pa="/assets/image-20221202175255980-850eb61d.png",la="/assets/image-20221202175446484-931eabb0.png",ha="/assets/image-20221202195321179-2f20421e.png",ua="/assets/image-20221202195434394-ca071dca.png",ba="/assets/image-20221202195526124-71c39eec.png",_a="/assets/image-20221202201215834-554e371f.png",xa="/assets/image-20221202201301479-33ef7f57.png",ya="/assets/image-20221202202159325-4d4076ed.png",za="/assets/image-20221203151547958-74aa7651.png",va="/assets/image-20221203152402274-59b721f5.png",ka="/assets/image-20221203152545389-7f8c7769.png",Ba="/assets/image-20221203154116457-5019d6d8.png",Ra="/assets/image-20221203154222100-4555dec8.png",Da="/assets/image-20221203154327571-579472f7.png",wa="/assets/image-20221203154612144-b0914c72.png",Oa="/assets/image-20221204145617706-bd65971d.png",Aa="/assets/image-20221204150119516-6787b0d8.png",Fa="/assets/image-20221204155705719-53c455fe.png",Ea="/assets/image-20221204155713712-5ecb4325.png",Ia="/assets/image-20221204155727473-446d1b54.png",Ga="/assets/image-20221204155803940-ed608c70.png",Na="/assets/image-20221207160857886-512107cb.png",Sa="/assets/image-20221207161438519-af3bf1c2.png",Va="/assets/image-20221207161757858-fee67fb3.png",Wa="/assets/image-20221207162507605-0c40a1f3.png",Xa="/assets/image-20221207162846076-5a7ee753.png",ja="/assets/image-20221211100811178-57d9ee37.png",qa="/assets/image-20221211101748153-887e6557.png",Ca="/assets/image-20221211101950283-9aa0642b.png",Ha="/assets/image-20221211102037098-b7f674b7.png",Ja="/assets/image-20221211102259099-c96d4beb.png",Ka="/assets/image-20221211102323726-4faff18b.png",La="/assets/image-20221211102358702-51978e5a.png",Ma={},Pa=g('<h2 id="知识" tabindex="-1"><a class="header-anchor" href="#知识" aria-hidden="true">#</a> 知识</h2><h3 id="初识" tabindex="-1"><a class="header-anchor" href="#初识" aria-hidden="true">#</a> 初识</h3><figure><img src="'+t+'" alt="image-20221123212117483" tabindex="0" loading="lazy"><figcaption>image-20221123212117483</figcaption></figure><figure><img src="'+n+`" alt="image-20221123212940418" tabindex="0" loading="lazy"><figcaption>image-20221123212940418</figcaption></figure><h3 id="通用命令" tabindex="-1"><a class="header-anchor" href="#通用命令" aria-hidden="true">#</a> 通用命令</h3><h4 id="获取配置" tabindex="-1"><a class="header-anchor" href="#获取配置" aria-hidden="true">#</a> 获取配置</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>config get *
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="keys" tabindex="-1"><a class="header-anchor" href="#keys" aria-hidden="true">#</a> keys</h4><figure><img src="`+s+'" alt="image-20221130105511581" tabindex="0" loading="lazy"><figcaption>image-20221130105511581</figcaption></figure><h4 id="dbsize" tabindex="-1"><a class="header-anchor" href="#dbsize" aria-hidden="true">#</a> dbsize</h4><figure><img src="'+r+'" alt="image-20221130105708566" tabindex="0" loading="lazy"><figcaption>image-20221130105708566</figcaption></figure><h4 id="exists" tabindex="-1"><a class="header-anchor" href="#exists" aria-hidden="true">#</a> exists</h4><figure><img src="'+d+'" alt="image-20221130105739123" tabindex="0" loading="lazy"><figcaption>image-20221130105739123</figcaption></figure><h4 id="del" tabindex="-1"><a class="header-anchor" href="#del" aria-hidden="true">#</a> del</h4><figure><img src="'+o+'" alt="image-20221130105803554" tabindex="0" loading="lazy"><figcaption>image-20221130105803554</figcaption></figure><h4 id="过期时间" tabindex="-1"><a class="header-anchor" href="#过期时间" aria-hidden="true">#</a> 过期时间</h4><figure><img src="'+c+'" alt="image-20221130105840647" tabindex="0" loading="lazy"><figcaption>image-20221130105840647</figcaption></figure><h4 id="type" tabindex="-1"><a class="header-anchor" href="#type" aria-hidden="true">#</a> type</h4><figure><img src="'+m+'" alt="image-20221130105905797" tabindex="0" loading="lazy"><figcaption>image-20221130105905797</figcaption></figure><h4 id="时间复杂度" tabindex="-1"><a class="header-anchor" href="#时间复杂度" aria-hidden="true">#</a> 时间复杂度</h4><figure><img src="'+f+'" alt="image-20221130105950833" tabindex="0" loading="lazy"><figcaption>image-20221130105950833</figcaption></figure><h3 id="字符串命令" tabindex="-1"><a class="header-anchor" href="#字符串命令" aria-hidden="true">#</a> 字符串命令</h3><h4 id="自增类" tabindex="-1"><a class="header-anchor" href="#自增类" aria-hidden="true">#</a> 自增类</h4><p>可用于分布式id生成器</p><figure><img src="'+p+'" alt="image-20221130110813055" tabindex="0" loading="lazy"><figcaption>image-20221130110813055</figcaption></figure><h4 id="set类" tabindex="-1"><a class="header-anchor" href="#set类" aria-hidden="true">#</a> set类</h4><figure><img src="'+l+'" alt="image-20221130111401222" tabindex="0" loading="lazy"><figcaption>image-20221130111401222</figcaption></figure><h4 id="mset类" tabindex="-1"><a class="header-anchor" href="#mset类" aria-hidden="true">#</a> mset类</h4><figure><img src="'+h+'" alt="image-20221130111532777" tabindex="0" loading="lazy"><figcaption>image-20221130111532777</figcaption></figure><h4 id="getset-append-strlen" tabindex="-1"><a class="header-anchor" href="#getset-append-strlen" aria-hidden="true">#</a> getset, append, strlen</h4><figure><img src="'+u+'" alt="image-20221130111737965" tabindex="0" loading="lazy"><figcaption>image-20221130111737965</figcaption></figure><h4 id="getrange" tabindex="-1"><a class="header-anchor" href="#getrange" aria-hidden="true">#</a> getrange</h4><figure><img src="'+b+'" alt="image-20221130111903836" tabindex="0" loading="lazy"><figcaption>image-20221130111903836</figcaption></figure><h3 id="哈希命令" tabindex="-1"><a class="header-anchor" href="#哈希命令" aria-hidden="true">#</a> 哈希命令</h3><p>储存对象</p><h4 id="hget" tabindex="-1"><a class="header-anchor" href="#hget" aria-hidden="true">#</a> hget</h4><figure><img src="'+_+'" alt="image-20221130164407329" tabindex="0" loading="lazy"><figcaption>image-20221130164407329</figcaption></figure><h4 id="hexists-hlen" tabindex="-1"><a class="header-anchor" href="#hexists-hlen" aria-hidden="true">#</a> hexists,hlen</h4><figure><img src="'+x+'" alt="image-20221130164540878" tabindex="0" loading="lazy"><figcaption>image-20221130164540878</figcaption></figure><h4 id="hmset" tabindex="-1"><a class="header-anchor" href="#hmset" aria-hidden="true">#</a> hmset</h4><figure><img src="'+y+'" alt="image-20221130164617023" tabindex="0" loading="lazy"><figcaption>image-20221130164617023</figcaption></figure><h4 id="hgetall-hvals-hkeys" tabindex="-1"><a class="header-anchor" href="#hgetall-hvals-hkeys" aria-hidden="true">#</a> hgetall,hvals,hkeys</h4><figure><img src="'+z+'" alt="image-20221130164831342" tabindex="0" loading="lazy"><figcaption>image-20221130164831342</figcaption></figure><h4 id="hincrby" tabindex="-1"><a class="header-anchor" href="#hincrby" aria-hidden="true">#</a> hincrby</h4><figure><img src="'+v+'" alt="image-20221130165319719" tabindex="0" loading="lazy"><figcaption>image-20221130165319719</figcaption></figure><h3 id="列表命令" tabindex="-1"><a class="header-anchor" href="#列表命令" aria-hidden="true">#</a> 列表命令</h3><p>lpush,rpush,lpop,rpop,llen,lset</p><h4 id="linsert" tabindex="-1"><a class="header-anchor" href="#linsert" aria-hidden="true">#</a> linsert</h4><figure><img src="'+k+'" alt="image-20221130165611399" tabindex="0" loading="lazy"><figcaption>image-20221130165611399</figcaption></figure><h4 id="lrem" tabindex="-1"><a class="header-anchor" href="#lrem" aria-hidden="true">#</a> lrem</h4><p>等值删除</p><figure><img src="'+B+'" alt="image-20221130165726722" tabindex="0" loading="lazy"><figcaption>image-20221130165726722</figcaption></figure><h4 id="ltrim" tabindex="-1"><a class="header-anchor" href="#ltrim" aria-hidden="true">#</a> ltrim</h4><p>范围删除</p><figure><img src="'+R+'" alt="image-20221130165827313" tabindex="0" loading="lazy"><figcaption>image-20221130165827313</figcaption></figure><h4 id="lrange" tabindex="-1"><a class="header-anchor" href="#lrange" aria-hidden="true">#</a> lrange</h4><figure><img src="'+D+'" alt="image-20221130165927668" tabindex="0" loading="lazy"><figcaption>image-20221130165927668</figcaption></figure><h4 id="lindex" tabindex="-1"><a class="header-anchor" href="#lindex" aria-hidden="true">#</a> lindex</h4><figure><img src="'+w+'" alt="image-20221130165944675" tabindex="0" loading="lazy"><figcaption>image-20221130165944675</figcaption></figure><h4 id="blpop" tabindex="-1"><a class="header-anchor" href="#blpop" aria-hidden="true">#</a> blpop</h4><p>堵塞读取</p><figure><img src="'+O+'" alt="image-20221130170222259" tabindex="0" loading="lazy"><figcaption>image-20221130170222259</figcaption></figure><h3 id="集合命令" tabindex="-1"><a class="header-anchor" href="#集合命令" aria-hidden="true">#</a> 集合命令</h3><p>元素不重复的数组</p><h4 id="交集" tabindex="-1"><a class="header-anchor" href="#交集" aria-hidden="true">#</a> 交集</h4><figure><img src="'+A+'" alt="image-20221201124120286" tabindex="0" loading="lazy"><figcaption>image-20221201124120286</figcaption></figure><h4 id="sadd-srem" tabindex="-1"><a class="header-anchor" href="#sadd-srem" aria-hidden="true">#</a> sadd, srem</h4><figure><img src="'+F+'" alt="image-20221201124200596" tabindex="0" loading="lazy"><figcaption>image-20221201124200596</figcaption></figure><h4 id="scard-sismember-srandmember-spop-smembers" tabindex="-1"><a class="header-anchor" href="#scard-sismember-srandmember-spop-smembers" aria-hidden="true">#</a> scard,sismember,srandmember, spop,smembers</h4><figure><img src="'+E+'" alt="image-20221201124239610" tabindex="0" loading="lazy"><figcaption>image-20221201124239610</figcaption></figure><h3 id="有序集合" tabindex="-1"><a class="header-anchor" href="#有序集合" aria-hidden="true">#</a> 有序集合</h3><figure><img src="'+I+'" alt="image-20221201124740917" tabindex="0" loading="lazy"><figcaption>image-20221201124740917</figcaption></figure><h4 id="zadd-zrem" tabindex="-1"><a class="header-anchor" href="#zadd-zrem" aria-hidden="true">#</a> zadd,zrem</h4><figure><img src="'+G+'" alt="image-20221201124936896" tabindex="0" loading="lazy"><figcaption>image-20221201124936896</figcaption></figure><figure><img src="'+N+'" alt="image-20221201124951859" tabindex="0" loading="lazy"><figcaption>image-20221201124951859</figcaption></figure><h4 id="zscore-zincrby-zcard" tabindex="-1"><a class="header-anchor" href="#zscore-zincrby-zcard" aria-hidden="true">#</a> zscore,zincrby,zcard</h4><figure><img src="'+S+'" alt="image-20221201125036949" tabindex="0" loading="lazy"><figcaption>image-20221201125036949</figcaption></figure><figure><img src="'+V+'" alt="image-20221201125039750" tabindex="0" loading="lazy"><figcaption>image-20221201125039750</figcaption></figure><figure><img src="'+W+'" alt="image-20221201125110414" tabindex="0" loading="lazy"><figcaption>image-20221201125110414</figcaption></figure><p>zrange,zrangebyscore</p><figure><img src="'+X+'" alt="image-20221201125209830" tabindex="0" loading="lazy"><figcaption>image-20221201125209830</figcaption></figure><figure><img src="'+j+'" alt="image-20221201125232566" tabindex="0" loading="lazy"><figcaption>image-20221201125232566</figcaption></figure><h4 id="zremrangebyrank" tabindex="-1"><a class="header-anchor" href="#zremrangebyrank" aria-hidden="true">#</a> zremrangebyrank</h4><figure><img src="'+q+'" alt="image-20221201125257947" tabindex="0" loading="lazy"><figcaption>image-20221201125257947</figcaption></figure><h3 id="慢查询" tabindex="-1"><a class="header-anchor" href="#慢查询" aria-hidden="true">#</a> 慢查询</h3><p>记录命令的执行时间</p><figure><img src="'+C+'" alt="image-20221201130147774" tabindex="0" loading="lazy"><figcaption>image-20221201130147774</figcaption></figure><figure><img src="'+H+'" alt="image-20221201130218293" tabindex="0" loading="lazy"><figcaption>image-20221201130218293</figcaption></figure><figure><img src="'+J+'" alt="image-20221201130335322" tabindex="0" loading="lazy"><figcaption>image-20221201130335322</figcaption></figure><h3 id="pipeline" tabindex="-1"><a class="header-anchor" href="#pipeline" aria-hidden="true">#</a> pipeline</h3><p>流水线，携带多条命令，通过一次网络发送，让服务器执行多条命令，然后返回结果。减少网络多次请求的耗时。</p><p>非原子操作，会将多个命令拆解为子命令插入执行队列中。</p><h3 id="发布订阅" tabindex="-1"><a class="header-anchor" href="#发布订阅" aria-hidden="true">#</a> 发布订阅</h3><figure><img src="'+K+'" alt="image-20221201133044164" tabindex="0" loading="lazy"><figcaption>image-20221201133044164</figcaption></figure><figure><img src="'+L+'" alt="image-20221201133058919" tabindex="0" loading="lazy"><figcaption>image-20221201133058919</figcaption></figure><figure><img src="'+M+'" alt="image-20221201133203006" tabindex="0" loading="lazy"><figcaption>image-20221201133203006</figcaption></figure><h3 id="位图" tabindex="-1"><a class="header-anchor" href="#位图" aria-hidden="true">#</a> 位图</h3><p>更改比特</p><figure><img src="'+P+'" alt="image-20221201133614121" tabindex="0" loading="lazy"><figcaption>image-20221201133614121</figcaption></figure><figure><img src="'+Q+'" alt="image-20221201133721902" tabindex="0" loading="lazy"><figcaption>image-20221201133721902</figcaption></figure><figure><img src="'+T+'" alt="image-20221201133745221" tabindex="0" loading="lazy"><figcaption>image-20221201133745221</figcaption></figure><figure><img src="'+U+'" alt="image-20221201133831305" tabindex="0" loading="lazy"><figcaption>image-20221201133831305</figcaption></figure><figure><img src="'+Y+'" alt="image-20221201133909091" tabindex="0" loading="lazy"><figcaption>image-20221201133909091</figcaption></figure><h3 id="hyperloglog" tabindex="-1"><a class="header-anchor" href="#hyperloglog" aria-hidden="true">#</a> hyperloglog</h3><p>极少内存去统计独立用户数</p><figure><img src="'+Z+'" alt="image-20221201134432065" tabindex="0" loading="lazy"><figcaption>image-20221201134432065</figcaption></figure><h3 id="geo" tabindex="-1"><a class="header-anchor" href="#geo" aria-hidden="true">#</a> GEO</h3><p>经纬度</p><figure><img src="'+$+'" alt="image-20221201135102534" tabindex="0" loading="lazy"><figcaption>image-20221201135102534</figcaption></figure><figure><img src="'+aa+'" alt="image-20221201135110826" tabindex="0" loading="lazy"><figcaption>image-20221201135110826</figcaption></figure><figure><img src="'+ia+'" alt="image-20221201135309142" tabindex="0" loading="lazy"><figcaption>image-20221201135309142</figcaption></figure><figure><img src="'+ea+'" alt="image-20221201135330480" tabindex="0" loading="lazy"><figcaption>image-20221201135330480</figcaption></figure><h3 id="持久化" tabindex="-1"><a class="header-anchor" href="#持久化" aria-hidden="true">#</a> 持久化</h3><h4 id="rdb" tabindex="-1"><a class="header-anchor" href="#rdb" aria-hidden="true">#</a> RDB</h4><figure><img src="'+ga+'" alt="image-20221202171757866" tabindex="0" loading="lazy"><figcaption>image-20221202171757866</figcaption></figure><figure><img src="'+ta+'" alt="image-20221202171828036" tabindex="0" loading="lazy"><figcaption>image-20221202171828036</figcaption></figure><p>用子线程去备份，异步</p><figure><img src="'+na+'" alt="image-20221202172242857" tabindex="0" loading="lazy"><figcaption>image-20221202172242857</figcaption></figure><h4 id="rdb问题" tabindex="-1"><a class="header-anchor" href="#rdb问题" aria-hidden="true">#</a> RDB问题</h4><figure><img src="'+sa+'" alt="image-20221202174108729" tabindex="0" loading="lazy"><figcaption>image-20221202174108729</figcaption></figure><p>没备份就宕机会丢失数据</p><figure><img src="'+ra+'" alt="image-20221202174148056" tabindex="0" loading="lazy"><figcaption>image-20221202174148056</figcaption></figure><h4 id="aof" tabindex="-1"><a class="header-anchor" href="#aof" aria-hidden="true">#</a> AOF</h4><p>每执行一条命令写入aof文件中</p><h5 id="always-everysec-no" tabindex="-1"><a class="header-anchor" href="#always-everysec-no" aria-hidden="true">#</a> always, everysec,no</h5><figure><img src="'+da+'" alt="image-20221202174646462" tabindex="0" loading="lazy"><figcaption>image-20221202174646462</figcaption></figure><figure><img src="'+oa+'" alt="image-20221202174743014" tabindex="0" loading="lazy"><figcaption>image-20221202174743014</figcaption></figure><p>根据操作系统来决定是否要刷新缓冲</p><figure><img src="'+ca+'" alt="image-20221202174813420" tabindex="0" loading="lazy"><figcaption>image-20221202174813420</figcaption></figure><h4 id="aof重写" tabindex="-1"><a class="header-anchor" href="#aof重写" aria-hidden="true">#</a> AOF重写</h4><p>将写入的命令优化</p><figure><img src="'+ma+'" alt="image-20221202175133404" tabindex="0" loading="lazy"><figcaption>image-20221202175133404</figcaption></figure><figure><img src="'+fa+'" alt="image-20221202175159635" tabindex="0" loading="lazy"><figcaption>image-20221202175159635</figcaption></figure><p>主动重写，异步fork进程</p><figure><img src="'+pa+'" alt="image-20221202175255980" tabindex="0" loading="lazy"><figcaption>image-20221202175255980</figcaption></figure><p>aof_buf,aof_rewrite_buf用于在重写期间缓冲新的命令，然后写入aof中</p><figure><img src="'+la+'" alt="image-20221202175446484" tabindex="0" loading="lazy"><figcaption>image-20221202175446484</figcaption></figure><h4 id="rdb和aof策略" tabindex="-1"><a class="header-anchor" href="#rdb和aof策略" aria-hidden="true">#</a> RDB和AOF策略</h4><figure><img src="'+ha+'" alt="image-20221202195321179" tabindex="0" loading="lazy"><figcaption>image-20221202195321179</figcaption></figure><figure><img src="'+ua+'" alt="image-20221202195434394" tabindex="0" loading="lazy"><figcaption>image-20221202195434394</figcaption></figure><figure><img src="'+ba+'" alt="image-20221202195526124" tabindex="0" loading="lazy"><figcaption>image-20221202195526124</figcaption></figure><h3 id="子进程开销和优化" tabindex="-1"><a class="header-anchor" href="#子进程开销和优化" aria-hidden="true">#</a> 子进程开销和优化</h3><figure><img src="'+_a+'" alt="image-20221202201215834" tabindex="0" loading="lazy"><figcaption>image-20221202201215834</figcaption></figure><figure><img src="'+xa+'" alt="image-20221202201301479" tabindex="0" loading="lazy"><figcaption>image-20221202201301479</figcaption></figure><h3 id="主从复制" tabindex="-1"><a class="header-anchor" href="#主从复制" aria-hidden="true">#</a> 主从复制</h3><p>变为从节点会清除本地数据</p><figure><img src="'+ya+'" alt="image-20221202202159325" tabindex="0" loading="lazy"><figcaption>image-20221202202159325</figcaption></figure><h4 id="全量复制" tabindex="-1"><a class="header-anchor" href="#全量复制" aria-hidden="true">#</a> 全量复制</h4><ol><li>从通知主节点要全量复制</li><li>主节点发送runId和偏移量</li><li>从节点保存信息</li><li>主节点bgsave异步保存RDB</li><li>发送RDB给从节点</li><li>发送最新命令的缓存给从节点</li><li>从节点刷盘老的数据，加载RDB和缓存</li></ol><figure><img src="'+za+'" alt="image-20221203151547958" tabindex="0" loading="lazy"><figcaption>image-20221203151547958</figcaption></figure><figure><img src="'+va+'" alt="image-20221203152402274" tabindex="0" loading="lazy"><figcaption>image-20221203152402274</figcaption></figure><h4 id="部分复制" tabindex="-1"><a class="header-anchor" href="#部分复制" aria-hidden="true">#</a> 部分复制</h4><p>网络抖动丢失会损失部分数据，部分复制可减少资源开销</p><ol><li>网络连接后，从节点发送自身偏移量和runId给主节点</li><li>若主从偏移量差距较小，则主节点发送部分数据给从节点</li></ol><figure><img src="'+ka+'" alt="image-20221203152545389" tabindex="0" loading="lazy"><figcaption>image-20221203152545389</figcaption></figure><h4 id="常见故障" tabindex="-1"><a class="header-anchor" href="#常见故障" aria-hidden="true">#</a> 常见故障</h4><figure><img src="'+Ba+'" alt="image-20221203154116457" tabindex="0" loading="lazy"><figcaption>image-20221203154116457</figcaption></figure><figure><img src="'+Ra+'" alt="image-20221203154222100" tabindex="0" loading="lazy"><figcaption>image-20221203154222100</figcaption></figure><figure><img src="'+Da+'" alt="image-20221203154327571" tabindex="0" loading="lazy"><figcaption>image-20221203154327571</figcaption></figure><figure><img src="'+wa+'" alt="image-20221203154612144" tabindex="0" loading="lazy"><figcaption>image-20221203154612144</figcaption></figure><h3 id="sentinel" tabindex="-1"><a class="header-anchor" href="#sentinel" aria-hidden="true">#</a> sentinel</h3><figure><img src="'+Oa+'" alt="image-20221204145617706" tabindex="0" loading="lazy"><figcaption>image-20221204145617706</figcaption></figure><h4 id="配置" tabindex="-1"><a class="header-anchor" href="#配置" aria-hidden="true">#</a> 配置</h4><p>monitor:监听的主节点，2个sentinel发现故障时开启故障转移</p><p>down..:3毫秒ping不通则故障</p><p>paraller-syncs:并发还是串行复制</p><p>failover-timeout:故障转移时间</p><figure><img src="'+Aa+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="客户端高可用" tabindex="-1"><a class="header-anchor" href="#客户端高可用" aria-hidden="true">#</a> 客户端高可用</h4><p>客户端通过发布订阅感知sentinel</p><figure><img src="'+Fa+'" alt="image-20221204155705719" tabindex="0" loading="lazy"><figcaption>image-20221204155705719</figcaption></figure><figure><img src="'+Ea+'" alt="image-20221204155713712" tabindex="0" loading="lazy"><figcaption>image-20221204155713712</figcaption></figure><p>客户端验证master节点</p><figure><img src="'+Ia+'" alt="image-20221204155727473" tabindex="0" loading="lazy"><figcaption>image-20221204155727473</figcaption></figure><p>master变化后通过订阅得知</p><figure><img src="'+Ga+'" alt="image-20221204155803940" tabindex="0" loading="lazy"><figcaption>image-20221204155803940</figcaption></figure><h4 id="工作流程" tabindex="-1"><a class="header-anchor" href="#工作流程" aria-hidden="true">#</a> 工作流程</h4><p>master节点挂掉期间，会被sentinel感知到，当多个sentinel都发现后，便推选一位sentinel作为执行者，执行一系列修复操作，把旧master标识为下线，挑选某个slave节点为新的master，把其余slave指向新的master。让新的master节点复制旧master内容，然后代替旧master。而旧master复活后会更改为slave，指向新master,并复制新master内容。</p><h4 id="定时任务" tabindex="-1"><a class="header-anchor" href="#定时任务" aria-hidden="true">#</a> 定时任务</h4><p>1秒ping下其他sentinel和redis节点，作心跳检测</p><p>2秒通过主节点的发布订阅来与其它sentinel节点交流，交换信息</p><p>10秒通过sentinel对master和slave执行info，来发现slave节点和确定主从关系</p><figure><img src="'+Na+'" alt="image-20221207160857886" tabindex="0" loading="lazy"><figcaption>image-20221207160857886</figcaption></figure><h4 id="主客观下线" tabindex="-1"><a class="header-anchor" href="#主客观下线" aria-hidden="true">#</a> 主客观下线</h4><p>单个sentinel感知有局限性，多数sentinel感知才客观</p><figure><img src="'+Sa+'" alt="image-20221207161438519" tabindex="0" loading="lazy"><figcaption>image-20221207161438519</figcaption></figure><h4 id="领导者选举" tabindex="-1"><a class="header-anchor" href="#领导者选举" aria-hidden="true">#</a> 领导者选举</h4><figure><img src="'+Va+'" alt="image-20221207161757858" tabindex="0" loading="lazy"><figcaption>image-20221207161757858</figcaption></figure><h4 id="故障转移" tabindex="-1"><a class="header-anchor" href="#故障转移" aria-hidden="true">#</a> 故障转移</h4><figure><img src="'+Wa+'" alt="image-20221207162507605" tabindex="0" loading="lazy"><figcaption>image-20221207162507605</figcaption></figure><figure><img src="'+Xa+'" alt="image-20221207162846076" tabindex="0" loading="lazy"><figcaption>image-20221207162846076</figcaption></figure><h3 id="cluster" tabindex="-1"><a class="header-anchor" href="#cluster" aria-hidden="true">#</a> cluster</h3><h4 id="虚拟槽" tabindex="-1"><a class="header-anchor" href="#虚拟槽" aria-hidden="true">#</a> 虚拟槽</h4><p>每个节点负责一个范围，当输入keys通过取余后，会发送给任意node节点。节点先查看是否为自己负责的槽，是则搜索返回结果，否则转发给对应槽的节点。</p><figure><img src="'+ja+'" alt="image-20221211100811178" tabindex="0" loading="lazy"><figcaption>image-20221211100811178</figcaption></figure><figure><img src="'+qa+'" alt="image-20221211101748153" tabindex="0" loading="lazy"><figcaption>image-20221211101748153</figcaption></figure><h4 id="配置和开启" tabindex="-1"><a class="header-anchor" href="#配置和开启" aria-hidden="true">#</a> 配置和开启</h4><figure><img src="'+Ca+'" alt="image-20221211101950283" tabindex="0" loading="lazy"><figcaption>image-20221211101950283</figcaption></figure><figure><img src="'+Ha+'" alt="image-20221211102037098" tabindex="0" loading="lazy"><figcaption>image-20221211102037098</figcaption></figure><figure><img src="'+Ja+'" alt="image-20221211102259099" tabindex="0" loading="lazy"><figcaption>image-20221211102259099</figcaption></figure><figure><img src="'+Ka+'" alt="image-20221211102323726" tabindex="0" loading="lazy"><figcaption>image-20221211102323726</figcaption></figure><figure><img src="'+La+'" alt="image-20221211102358702" tabindex="0" loading="lazy"><figcaption>image-20221211102358702</figcaption></figure><p>可通过ruby脚本trib命令式部署</p>',203),Qa=[Pa];function Ta(Ua,Ya){return i(),e("div",null,Qa)}const $a=a(Ma,[["render",Ta],["__file","Redis 进阶.html.vue"]]);export{$a as default};
